/*! Innerwave Spreadsheet - v0.2.409-SNAPSHOT - 2014-12-30
* Copyright (c) 2014 innerwave.co.kr; Licensed  */
!function(a){"function"==typeof define&&define.amd?define(["jquery","./core","./widget","./draggable","./sortable","./mouse","./slide","./resizable"],a):a(jQuery)}(function(a){"use strict";function b(a){var b,c=2166136261,d=c;for(b=0;b<a.length;++b)d^=a.charCodeAt(b),d+=(d<<1)+(d<<4)+(d<<7)+(d<<8)+(d<<24);return d>>>0}function c(b){return Math.round(b.offsetLeft+b.offsetWidth)-parseInt(a(b).css("border-right-width").replace("px","")||1)}function d(b){return Math.round(b.offsetTop+b.offsetHeight)-parseInt(a(b).css("border-bottom-width").replace("px","")||1)}function e(b){return a.map(b.toString(26).split(""),function(a,c){return a=parseInt(a,26),b>25&&0===c&&(a-=1),String.fromCharCode(a+65)}).join("")}function f(){this.find=function(a){return this.indexOf(this.elementByIds[a])},this.has=function(a){return!!this.elementByIds[a.uuid]},this.get=function(a){return this.elements[a]},this.getById=function(b){var c=this.elementByIds[b];return c||(c=a.map(this.elements,function(a){return a.id===b?a:null})[0]),c},this.indexOf=function(b){return a.inArray(b,this.elements,0)},this.addAll=function(a){for(var b=0,c=a.length;c>b;b++)this.add(a[b])},this.add=function(a){return a.uuid=a.uuid||t("el"),this.has(a)||(this.elements.push(a),this.elementByIds[a.uuid]=a,this.length++),this},this.insert=function(a,b){return a.uuid=a.uuid||t("el"),this.has(a)||(this.elementByIds[a.uuid]=a,0>b?this.elements.unshift(a):b>=this.elements.length?this.elements.push(a):this.elements.splice(b,0,a),this.length++),this},this.insertBefore=function(a,b){return this.insert(a,--b)},this.insertAfter=function(a,b){return this.insert(a,++b)},this.empty=function(){this.length=0,this.elements.length=0,this.elements=[]},this.remove=function(a){var b=this.indexOf(a);return b>=0&&(this.elements.splice(b,1),this.length--),this.elementByIds[a.uuid]=null,delete this.elementByIds[a.uuid],this},this.move=function(a,b){a="string"==typeof a?this.elementByIds[a]:a;var c=this.indexOf(a),d=c+b;if(!(c>=0))throw"can not find element";return this.elements.splice(c,1),0>d?this.elements.unshift(a):d>=this.elements.length?this.elements.push(a):this.elements.splice(d,0,a),this},this.each=function(a,b){var c=0;if("string"==typeof a)for(;c<this.length;c++)this.elements[c][a].apply(this.elements[c],b);else if(a instanceof Function)for(;c<this.length;c++)a.apply(this.elements[c],b)},this.eventFrefix="collection",this._trigger=function(b,c,d){var e=this.events[b];return c=a.Event(c),c.type=(b===this.eventPrefix?b:this.eventPrefix+b).toLowerCase(),c.target=this,d=d||{},!(a.isFunction(e)&&e.apply(this,[c].concat(d))===!1||c.isDefaultPrevented())},this.toArray=function(){return this.elements},this.toJSON=function(){return JSON.stringify(tis.elements)},this.toXML=function(){for(var b=a.parseXML("<collection></collection>"),c=0,d=this.elements.length;d>c;c++)b.appendChild(this.elements[c].toXML());return b},this.toXMLString=function(){return(new XMLSerializer).serializeToString(this.toXML())}}function g(){this.length=0,this.elements=[],this.elementByIds={}}function h(){this.length=0,this.elements=[],this.elementByIds={}}function i(){this.length=0,this.elements=[],this.elementByIds={}}function j(){this.length=0,this.elements=[],this.elementByIds={}}function k(){this.length=0,this.elements=[],this.elementByIds={}}function l(){this.id=t("sheet"),this.className="spreadsheet",this.rows=new g,this.columnGroups=new h,this.columns=new i,this.cells=new j,this.addColumn=function(a){var c=new o(a);this.columns.add(c);var d=this.columnGroups.getById(b(a.group||c.id));return d||(d=new n({id:b(a.group||c.id),label:a.group||""}),d.parent=this,this.columnGroups.add(d)),d.columns.add(c),c},this.addColumns=function(a){for(var b=[],c=0,d=a.length;d>c;c++)b.push(this.addColumn(a[c]));return b},this.addRow=function(a){var b=new p(a);return this.rows.add(b),b},this.addRows=function(a){for(var b=[],c=0,d=a.length;d>c;c++)b.push(this.addRow(a[c]));return b},this.addCell=function(a){var b=new q(a);return this.cells.add(b),b},this.addCells=function(a){for(var b=[],c=0,d=a.length;d>c;c++)b.push(this.addCell(a[c]));return b}}function m(){var b=[];return{hasClass:function(c){return c?(b=this.className?this.className.split(/\s+/):[],a.inArray(c,b,0)):-1},addClass:function(a){a&&this.hasClass(a)<0&&(b.push(a),this.className=b.join(" "),this.ui&&this.ui.addClass(a))},removeClass:function(a){if(a){var c=this.hasClass(a);c>=0&&(b.splice(c,1),this.className=b.join(" "),this.ui&&this.ui.removeClass(a))}},toggleClass:function(a){return a?void(this.hasClass(a)<0?this.addClass(a):this.removeClass(a)):!1}}}function n(b){this.id=b.id,this.uuid=b.id,this.parent=b.parent,this.label=b.label,this.columns=new i,this._ui=b.ui||a('<li class="spreadsheet-column spreadsheet-column-group ui-state-default"><span></span></li>'),this.width=function(){var b=0,c=0,d=0,e=this.parent?a.map(this.parent.columns.toArray(),function(a){if(!a.ui)return null;var b=a.ui.parent();return b&&b.children().index(a.ui)>=0?a:null}):[];return a.each(this.columns.toArray(),function(){a.inArray(this,e)>=0&&(b+=this.offset.width,c=parseInt(this.ui.css("border-right-width")),d++)}),b+c*(d-1)},this.ui=function(a){return a&&(this._ui=a),this._ui.width(this.width()).find("span").text(this.label).end()}}function o(a){a=a||{},this.uuid=t("column"),this.id=a.id||this.uuid,this.label=a.label,this.width=a.width||80,this.height=a.height||26,this.className="spreadsheet-column ui-state-default "+(a.className||""),this.group=a.group,this.renderer=null,this.editor=null,this.buttons=null,this.offset={left:0,width:this.width,outerWidth:0,innerWidth:0},this.cells=new j}function p(a){a=a||{},this.uuid=t("row"),this.id=a.id||this.uuid,this.height=a.height||26,this.label=a.label,this.width=a.width||80,this.renderer=null,this.buttons=null,this.editor=null,this.className="ui-state-default spreadsheet-row "+(a.className||""),this.offset={top:0,height:this.height,outerHeight:0,innerHeight:0},this.cells=new j}function q(a){a=a||{},this.uuid=t("cell"),this.id=a.id||this.uuid,this.value=a.value,this.formula=a.formula,this.renderer=null,this.editor=null,this.className="spreadsheet-cell "+(a.classname||""),this.rows=a.rows||[],this.columns=a.columns||[]}var r=function(){{var a;(new Date).getTime()}return function(b){a=(new Date).getTime()}}();r("시작");var s=function(){},t=function(){var a=0;return function(b){return b+a++}}();return g.prototype=new f,h.prototype=new f,i.prototype=new f,j.prototype=new f,k.prototype=new f,n.prototype=new m,o.prototype=new m,o.prototype.toJSON=function(){var a={};a.uuid=this.uuid,a.id=this.id,a.label=this.label,a.width=this.width,a.height=this.height,a.className=this.className,a.cells=[];for(var b=0,c=this.cells.length;c>b;b++)a.cells.push(this.cells.get(b).uuid);return JSON.stringify(a)},o.prototype.toXML=function(){var a=[];return a.push("<column>"),a.push("<uuid>"),a.push(this.uuid),a.push("</uuid>"),a.push("<id>"),a.push(this.id),a.push("</id>"),a.push("<label>"),a.push(this.label),a.push("</label>"),a.push("<width>"),a.push(this.width),a.push("</width>"),a.push("<height>"),a.push(this.height),a.push("</height>"),a.push("<className>"),a.push(this.className),a.push("</className>"),a.push("</column>"),a.join("")},p.prototype=new m,p.prototype.toJSON=function(){var a={};return a.uuid=this.uuid,a.id=this.id,a.height=this.height,a.width=this.height,a.label=this.label,a.className=this.className,a.cells=this.cells,JSON.stringify(a)},p.prototype.toXML=function(){var a=[];return a.push("<row>"),a.push("NOT IMPLEMENTED YET!!!"),a.push("</row>"),a.join("")},q.prototype=new m,q.prototype.toJSON=function(){var a={};return a.uuid=this.uuid,a.id=this.id,a.value=this.value,a.formula=this.formula,a.className=this.className,a.rows=this.rows,a.columns=this.columns,JSON.stringify(a)},q.prototype.toXML=function(){var a=[];return a.push("<cell>"),a.push("NOT IMPLEMENTED YET!!!"),a.push("</cell>"),a.join("")},a.widget("innerwave.spreadsheet",{version:"0.2.409-SNAPSHOT",options:{height:"auto",width:"auto",maxHeight:null,maxWidth:null,minHeight:150,minWidth:150,title:null,columns:[],data:[],dataParseUnit:10,defaultColumnWidth:50,defaultRowHeight:24,showTitle:!0,showColumnGroups:!1,showColumnHeaders:!1,showRowHeaders:!1,showValueWindow:!1,showDefaultGrid:!0,defaultGridLineColor:"#CCC",numberOfFixedRows:0,numberOfFixedColumns:0,ready:s,update:s},columns:function(a){return void 0===a?this.sheet.columns:(this.sheet.columns.empty(),this.sheet.addColumns(a),void this._trigger("columnChanged"))},rows:function(a){return void 0===a?this.sheet.rows:(this.sheet.rows.empty(),this.sheet.addRows(a),void this._trigger("rowChanged"))},data:function(a){return this.dataProvider=this.dataProvider||new k,void 0===a?this.dataProvider:(r(this.uuid+".< set data into dataprovider"),this.dataProvider.empty(),this.dataProvider.addAll(a),this.cancleParseData=!1,this.initialized&&this._trigger("dataChanged"),void r(this.uuid+".set data into dataprovider >"))},_create:function(){this.uuid=t("sheet"),r(this.uuid+".<_create"),this.original={css:{display:this.element[0].style.display,width:this.element[0].style.width,minWidth:this.element[0].style.minWidth,maxWidth:this.element[0].style.maxWidth,minHeight:this.element[0].style.minHeight,maxHeight:this.element[0].style.maxHeight,height:this.element[0].style.height},contents:this.element[0].innerHTML},this.originalTitle=this.element.attr("title"),this.options.title=this.options.title||this.originalTitle,this.element.attr("title",""),this.boundary={firstRow:0,numberOfRows:50,firstColumn:0,numberOfColumns:50},this._scrolling=!1,this.cancleParseData=!1,this.dataProvider=new k,this.sheet=new l,this.sheet.addColumns(this.options.columns),this.data(this.options.data),this.options.columns=null,this.options.data=null,this._render(),r(this.uuid+"._create>")},_setOption:function(a,b){return"columns"===a?this.columns(b):"data"===a&&this.data(b),this._super(a,b),this},_parseEachData:function(b,c){var d,e,f={},g=this;a.each(b,function(a){return"id"===a||"uuid"===a||"height"===a?void(c.key=this):(f={value:this},e=g.sheet.addCell(f),c.cells.add(e),d=g.sheet.columns.getById(a),d.cells.add(e),e.rows.push(c),void e.columns.push(d))})},_parseData:function(){if(this.initialized&&!this.cancleParseData){r(this.uuid+".< _parseData");var a,b,c=0,d=this.dataProvider.length;this.sheet.rows.empty(),this.sheet.cells.empty();var e=this.dataProvider.toArray(),f=[],g=this.options.dataParseUnit,h=0,i=0;for(c=0,d=e.length;d>c;c+=g)f.push(e.slice(c,Math.min(c+g,d)));var j=function(g){for(c=0,d=g.length;d>c;c++)b=g[c],a=this.sheet.addRow(b),this._parseEachData(b,a);if(h+=c,void 0!==this.$uiProgressBar.progressbar("instance")&&this.$uiProgressBar.progressbar("value",parseInt(h/e.length*100)),this._delay(function(){this._trigger("rowChanged")},50),i>=f.length-1)r(this.uuid+"._parseData >");else{if(this.cancleParseData)return void r(this.uuid+"._parseData CANCELED >");this._delay(function(){j.call(this,f[++i])},5)}};f.length>0&&j.call(this,f[i])}},stopParseData:function(){r(this.uuid+".stopParseData >"),this.cancleParseData=!0,this._hideProgressBar("slow")},_render:function(){r(this.uuid+".< _render");var b=this;this.element.show(),this.element.width("auto"===this.options.width||"100%"===this.options.width?Math.max(this.original.css.minWidth,this.original.css.width||this.element.attr("width")):this.options.width),this.element.height("auto"===this.options.height||"100%"===this.options.height?Math.max(this.original.css.minHeight,this.original.css.height||this.element.attr("height")):this.options.height),this.element.addClass("spreadsheet ui-widget ui-state-default"),this._showProgressBar(),this.$uiContainer=a('<div class="spreadsheet-container">').width(this.element.width()).height(this.element.height()).appendTo(this.element),this.$uiHeader=a('<div class="spreadsheet-header ui-state-default">').appendTo(this.$uiContainer),this.$uiViewport=a('<div class="spreadsheet-viewport ui-widget-content">').appendTo(this.$uiContainer),this.$defaultGrid=a('<canvas class="spreadsheet-gridlines">').appendTo(this.$uiViewport),this.$uiColumnViewport=a('<div class="spreadsheet-viewport-column ui-state-default">').appendTo(this.$uiContainer),this.$uiColumns=a('<ul class="spreadsheet-column-list">').sortable({zIndex:9999,placeholder:"ui-state-highlight spreadsheet-placeholder-column",start:function(c,d){var e=b.$uiColumns.children(),f=e.index(d.item[0]);a(d.item[0]).data("originalIndex",f)},stop:function(c,d){var e=a(d.item[0]).data("originalIndex"),f=b.$uiColumns.children(),g=f.index(d.item[0]);b.sheet.columns.move(d.item[0].id,g-e),b._trigger("columnChanged")}}).disableSelection().appendTo(this.$uiColumnViewport),this.$uiRowViewport=a('<div class="spreadsheet-viewport-row ui-state-default">').appendTo(this.$uiContainer),this.$uiRows=a('<ul class="spreadsheet-row-list">').sortable({placeholder:"ui-state-highlight spreadsheet-placeholder-row",start:function(c,d){var e=b.$uiRows.children(),f=e.index(d.item[0]);a(d.item[0]).data("originalIndex",f)},stop:function(c,d){var e=a(d.item[0]).data("originalIndex"),f=b.$uiRows.children(),g=f.index(d.item[0]);b.sheet.rows.move(d.item[0].id,g-e),b._trigger("rowChanged")}}).disableSelection().appendTo(this.$uiRowViewport),this.$uiColumnViewport.css("margin-left",this.$uiRowViewport.outerWidth()+"px"),this._renderTitleBar(),this._renderColumns(),this._renderRows(),this._createValueWindow(),this.$uiViewport.width(this.$uiContainer.width()-this.$uiRowViewport.outerWidth()).height(this.$uiContainer.height()-this.$uiHeader.outerHeight()-this.$uiColumnViewport.outerHeight()),this.$uiFooter=a('<div class="spreadsheet-footer ui-state-default">').appendTo(this.$uiContainer),this.$uiVerticalScrollArea=a('<div class="spreadsheet-scrollbar scroll-area-vertical">').appendTo(this.$uiContainer),this.$uiHorizontalScrollArea=a('<div class="spreadsheet-scrollbar scroll-area-horizontal">').appendTo(this.$uiFooter),this._setupEvents(),r(this.uuid+". _render >"),this._trigger("initialized")},_hideProgressBar:function(a){this.$uiProgressBar&&this.$uiProgressBar.hide(a)},_showProgressBar:function(){var b=this;this.$uiProgressBar?this.$uiProgressBar.show():this.options.progressBar?this.$uiProgressBar=this.options.progressBar.appendTo(this.element).show():(this.$uiProgressLabel=a('<div class="spreadsheet-progress-label">').text("Loading......"),this.$uiProgressBar=a('<div class="spreadsheet-progress">').progressbar({value:!1,change:function(){b.$uiProgressLabel.text(b.$uiProgressBar.progressbar("value")+"% ").css("left",(b.$uiProgressBar.width()-b.$uiProgressLabel.outerWidth())/2+"px")},complete:function(){b.$uiProgressLabel.text("100%"),b.$uiProgressLabel.css("left",(b.$uiProgressBar.width()-b.$uiProgressLabel.outerWidth())/2+"px"),b.$uiProgressBar.hide("slow")}}).append(this.$uiProgressLabel).appendTo(this.element)),this.$uiProgressBar.attr("title","STOP! Click to stop the data is parsed.").off("click").click(function(){b.stopParseData()}).css({top:(this.element.height()-this.$uiProgressBar.outerHeight())/2+"px",left:(this.element.width()-this.$uiProgressBar.outerWidth())/2+"px"})},_renderTitleBar:function(){this.options.showTitle===!0?this.$uiTitle=a('<span class="spreadsheet-title">').text(this.options.title).appendTo(this.$uiHeader):this.$uiHeader.remove()},_createValueWindow:function(){this.options.showValueWindow===!0&&(this.$uiValueWindow=a('<div class="spreadsheet-value-window ui-widget">').append('<span class="value-editor-label">Value: </span>').append('<input type="text" class="ui-widget ui-widget-content"/>').appendTo(this.$uiColumnViewport))},_createUiColumn:function(c,d){var f=this;return d.ui=a("<li>").attr("id",d.uuid).addClass(d.className).width(d.offset.width).append(a("<span>").text(void 0!==d.label?d.label:e(c))).append('<div class="indicator">').data("column",d).button().removeClass("ui-corner-all").resizable({handles:"e",minWidth:2,stop:function(b,c){var e=a(c.element);d.width=c.size.width,d.offset.width=c.size.width,d.offset.outerWidth=e.outerWidth(),d.offset.innerWidth=e.innerWidth(),f._renderColumns(f.boundary.firstColumn)}}).on("click",function(a){a.ctrlKey===!1&&(f.sheet.cells.each("removeClass",["ui-state-highlight"]),f.sheet.columns.each("removeClass",["ui-state-highlight"]),f.sheet.rows.each("removeClass",["ui-state-highlight"])),d.addClass("ui-state-highlight"),d.cells.each("addClass",["ui-state-highlight"])}).mousedown(function(){var c=[],d=a(this).data("column");if(d.group){var e=f.sheet.columnGroups.getById(b(d.group));c=a.map(e.columns.toArray(),function(a){return a.ui})}else c=f.$uiColumns.children().map(function(){return d=f.sheet.columns.getById(this.id),d.group?null:this});f.$uiColumns.sortable("option","items",c)})},__renderColumns:function(c){function d(){for(;j>i&&l<this.$uiViewport.width();i++)e=this.sheet.columns.get(i),e.removeClass("ui-state-hover"),f=(this.ui||this._createUiColumn(i,e)).appendTo(this.$uiColumns),f.removeClass().addClass(e.className),e.offset={left:e.ui[0].offsetLeft,width:f.width(),outerWidth:f.outerWidth(),innerWidth:f.innerWidth()},l+=e.offset.outerWidth,g=this.sheet.columnGroups.getById(b(e.group||e.id)),g||(g=new n({id:b(e.group||e.id),label:e.group}),g.parent=this,g.columns.add(e),h.sheet.columnGroups.add(g)),k.push(g)}r(this.uuid+".<__renderColumns");var e,f,g,h=this,i=0,j=0,k=[],l=0;if(this.$uiColumns.children().detach(),this.options.numberOfFixedColumns>0&&(i=0,j=this.options.numberOfFixedColumns,d.call(this)),c=Math.max(Math.min(Math.max(this.options.numberOfFixedColumns,c||0),this.sheet.columns.length-1),0),this.boundary.firstColumn=c,i=c,j=Math.min(c+this.boundary.numberOfColumns,this.sheet.columns.length),d.call(this),this.options.showColumnGroups===!1)this.$uiColumnGroups&&this.$uiColumnGroups.hide();else for(this.$uiColumnGroups=this.$uiColumnGroups||a('<ul class="spreadsheet-column-group-list">').insertBefore(this.$uiColumns),this.$uiColumnGroups.children().each(function(){a(this).detach()}),i=0,j=k.length;j>i;i++)g=k[i],g.ui().appendTo(this.$uiColumnGroups);this.options.showColumnHeaders===!1?(this.$uiColumnGroups&&this.$uiColumnGroups.hide(),this.$uiColumns.addClass("hidden")):(this.$uiColumnGroups&&this.$uiColumnGroups.show(),this.$uiColumns.removeClass("hidden")),this.$uiViewport.width(this.$uiContainer.width()-this.$uiRowViewport.outerWidth()).height(this.$uiContainer.height()-this.$uiHeader.outerHeight()-this.$uiColumnViewport.outerHeight()),r(this.uuid+".__renderColumns>"),this._renderData()},_renderColumns:function(){var a={};return function(b){r(this.uuid+"."+a[this.uuid]+".<_renderColumns"),clearTimeout(a[this.uuid]),a[this.uuid]=this._delay(function(){this.__renderColumns(b)},30),r(this.uuid+"."+a[this.uuid]+"._renderColumns>")}}(),_onRowResize:function(b,c){var d=a(b.element);c.height=b.size.height,c.offset.height=b.size.height,c.offset.outerHeight=d.outerHeight(),c.offset.innerHeight=d.innerHeight(),this._renderRows(this.sheet.rows.indexOf(this.sheet.rows.getById(this.$uiRows.children().filter("li:first").attr("id"))))},_createUiRow:function(b,c){var d=this;return c.ui=a("<li>").attr("id",c.uuid).addClass(c.className).height(c.height).append(a("<span>").text(c.label||b+1)).append('<div class="indicator">').button().removeClass("ui-corner-all").resizable({handles:"s",minHeight:2,stop:function(a,b){d._onRowResize(b,c)}}).on("click",function(a){a.ctrlKey===!1&&(d.sheet.cells.each("removeClass",["ui-state-highlight"]),d.sheet.columns.each("removeClass",["ui-state-highlight"]),d.sheet.rows.each("removeClass",["ui-state-highlight"])),c.addClass("ui-state-highlight"),c.cells.each("addClass",["ui-state-highlight"])})},__renderRows:function(a){function b(){for(var a,b;d>c&&f>e;c++)a=this.sheet.rows.get(c),a.removeClass("ui-state-hover"),b=(a.ui||this._createUiRow(c,a)).appendTo(this.$uiRows),b.removeClass().addClass(a.className),a.offset={top:a.ui[0].offsetTop,height:b.height(),outerHeight:b.outerHeight(),innerHeight:b.innerHeight()},e+=a.offset.outerHeight}var c=0,d=0,e=0,f=this.$uiViewport.height();this.$uiRows.children().detach(),this.options.numberOfFixedRows>0&&(c=0,d=this.options.numberOfFixedRows,b.call(this)),a=Math.max(Math.min(Math.max(this.options.numberOfFixedRows,a||0),this.sheet.rows.length-1),0),this.boundary.firstRow=a,c=a,d=Math.min(a+this.boundary.numberOfRows,this.sheet.rows.length),b.call(this),this.options.showRowHeaders===!1?(this.$uiRowViewport.addClass("hidden"),this.$uiColumnViewport.css("margin-left",this.$uiRowViewport.outerWidth()+"px")):this.$uiRowViewport.removeClass("hidden"),this.$uiViewport.width(this.$uiContainer.width()-this.$uiRowViewport.outerWidth()).height(this.$uiContainer.height()-this.$uiHeader.outerHeight()-this.$uiColumnViewport.outerHeight()),this._renderData()},_renderRows:function(){var a={};return function(b){clearTimeout(a[this.uuid]),a[this.uuid]=this._delay(function(){this.__renderRows(b)},10)}}(),_offsetOfCell:function(a){var b,c,d,e=Number.MAX_VALUE,f=Number.MAX_VALUE,g=0,h=0;for(b=0,c=a.columns.length;c>b;b++)d=a.columns[b],e=Math.min(e,d.offset.left),g+=d.offset.innerWidth;for(b=0,c=a.rows.length;c>b;b++)d=a.rows[b],f=Math.min(f,d.offset.top),h+=d.offset.innerHeight;return{left:e,top:f,width:g,height:h}},_createUiCell:function(b){var c=this,d=a("<span>").text(b.value).wrap('<div class="spreadsheet-cell">').parent().attr("title",b.value).addClass(b.className).hover(function(){c._scrolling||(d.addClass("ui-state-hover"),a.each(b.columns,function(){this.addClass("ui-state-hover")}),a.each(b.rows,function(){this.addClass("ui-state-hover")}))},function(){d.removeClass("ui-state-hover"),a.each(b.columns,function(){this.removeClass("ui-state-hover")}),a.each(b.rows,function(){this.removeClass("ui-state-hover")})}).on("click",function(d){this.currentCell=b,this.currentCells=this.currentCells||[],d.ctrlKey===!1&&(this.currentCells=[],c.sheet.cells.each("removeClass",["ui-state-highlight"]),c.sheet.columns.each("removeClass",["ui-state-highlight"]),c.sheet.rows.each("removeClass",["ui-state-highlight"])),this.currentCells.push(b),b.addClass("ui-state-highlight"),a.each(b.columns,function(){this.addClass("ui-state-highlight")}),a.each(b.rows,function(){this.addClass("ui-state-highlight")}),c.options.showValueWindow===!0&&c.$uiValueWindow.find("input:text").val(b.value)}).disableSelection();return b.ui=d,d},_renderData:function(){var b={};return function(){clearTimeout(b[this.uuid]),this._createScrollbars(),this._drawDefaultGrid(),b[this.uuid]=this._delay(function(){var b,c,d,e=this.boundary.firstColumn,f=this.boundary.firstRow,g=this.$uiColumns.children().length,h=this.$uiRows.children().length,i=this.options.numberOfFixedRows,j=this.options.numberOfFixedColumns,k=this.sheet.rows.toArray(),l=this.sheet.columns.toArray(),m=k.slice(f,f+h-i).concat(k.slice(0,i)),n=l.slice(e,e+g-j).concat(l.slice(0,j)),o=a.map(m,function(b){return a.map(b.cells.toArray(),function(b){return a.map(b.columns,function(b){return a.inArray(b,n)>=0?!0:null}).length>0?b:null})});for(this.$uiViewport.find("div.spreadsheet-cell").detach(),b=0,c=o.length;c>b;b++)d=o[b],(d.ui||this._createUiCell(d)).removeClass().addClass(d.className).css(this._offsetOfCell(d)).appendTo(this.$uiViewport)},30)}}(),_createScrollbars:function(){var b=this,c=Math.max(this.options.numberOfFixedRows,0),d=this.sheet.rows.length-1,e=Math.max(this.options.numberOfFixedColumns,0),f=this.sheet.columns.length-1;this.$uiVerticalScrollArea.height(this.$uiContainer.height()-this.$uiHeader.outerHeight()-this.$uiColumnViewport.outerHeight()-parseInt(this.$uiVerticalScrollArea.css("border-top").replace("px","")||1)-parseInt(this.$uiVerticalScrollArea.css("bottom").replace("px","")||0)),this.$uiHorizontalScrollArea.width(this.$uiContainer.width()-this.$uiRowViewport.outerWidth()-parseInt(this.$uiHorizontalScrollArea.css("border-left").replace("px","")||1)-parseInt(this.$uiHorizontalScrollArea.css("border-right").replace("px","")||1)-parseInt(this.$uiHorizontalScrollArea.css("right").replace("px","")||0)),this.$uiVerticalScrollbar?this.$uiVerticalScrollbar.scroller("option","min",c).scroller("option","max",d):this.$uiVerticalScrollbar=a('<div class="spreadsheet-scrollbar spreadsheet-scrollbar-vertical">').scroller({orientation:"vertical",value:c,min:c,max:d,step:1,start:function(){b._scrolling=!0},stop:function(){b._scrolling=!1},slide:function(a,c){b._renderRows(c.value)}}).appendTo(this.$uiVerticalScrollArea),this.$uiHorizontalScrollbar?this.$uiHorizontalScrollbar.scroller("option","min",e).scroller("option","max",f):this.$uiHorizontalScrollbar=a('<div class="spreadsheet-scrollbar spreadsheet-scrollbar-horizontal">').scroller({value:e,min:e,max:f,step:1,start:function(){b._scrolling=!0},stop:function(){b._scrolling=!1},slide:function(a,c){b._renderColumns(c.value)}}).appendTo(this.$uiHorizontalScrollArea)},_drawDefaultGrid:function(){if(this.$uiViewport.css({top:this.$uiRows.offset().top-this.$uiContainer.offset().top,left:this.$uiColumns.offset().left-this.$uiContainer.offset().left}),Modernizr.canvas&&this.options.showDefaultGrid){var b=0,e=0;this.$uiColumns.children().each(function(){b+=a(this).outerWidth()}),this.$uiRows.children().each(function(){e+=a(this).outerHeight()}),this.$defaultGrid.attr({width:b,height:e});var f=this.$defaultGrid[0].getContext("2d");f.fillStyle=this.options.defaultGridLineColor,this.$uiColumns.children().each(function(){f.fillRect(c(this),0,1,e)}),this.$uiRows.children().each(function(){f.fillRect(0,d(this),b,1)})}},_setupEvents:function(){var b=this;this._on({spreadsheetcolumnchanged:function(){this.$uiHorizontalScrollbar?(this.$uiHorizontalScrollbar.scroller("option","max",this.sheet.columns.length),this._renderColumns(this.$uiHorizontalScrollbar.scroller("value"))):this._renderColumns()},spreadsheetrowchanged:function(){this.$uiVerticalScrollbar?(this.$uiVerticalScrollbar.scroller("option","max",this.sheet.rows.length),this._renderRows(this.$uiVerticalScrollbar.scroller("value"))):this._renderRows()},spreadsheetdatachanged:function(){this._parseData()},spreadsheetinitialized:function(){this.initialized=!0,this.dataProvider.length>0&&this._delay(this._parseData,500)}}),a.each([this.$uiColumnViewport,this.$uiHorizontalScrollArea],function(){this.mousewheel(function(a){a.preventDefault(),b._onHorizontalWheel.call(b,a.deltaY||a.deltaX)})}),a.each([this.$uiRowViewport,this.$uiVerticalScrollArea],function(){this.mousewheel(function(a){a.preventDefault(),b._onVerticalWheel.call(b,a.deltaY||a.deltaX)})}),this.$uiViewport.mousewheel(function(a){a.preventDefault(),a.shiftKey===!0?b._onHorizontalWheel.call(b,a.deltaX||a.deltaY):b._onVerticalWheel.call(b,a.deltaY)})},_onVerticalWheel:function(a){this.verticalScrollBy(a)},_onHorizontalWheel:function(a){this.horizontalScrollBy(a)},verticalScrollBy:function(a){var b=this.$uiVerticalScrollbar.scroller("value")-a;this._renderRows(b),this.$uiVerticalScrollbar.scroller("value",b)},horizontalScrollBy:function(a){var b=this.$uiHorizontalScrollbar.scroller("value")-a;this._renderColumns(b),this.$uiHorizontalScrollbar.scroller("value",b)},_startKeyNavigation:function(b,c){switch(b.keyCode){case a.ui.keyCode.HOME:return c.column=0,c.row=0,!1;case a.ui.keyCode.END:return c.column=sheet.columns.length-1,c.row=sheet.rows.length-1,!1;case a.ui.keyCode.PAGE_UP:case a.ui.keyCode.PAGE_DOWN:case a.ui.keyCode.UP:case a.ui.keyCode.RIGHT:case a.ui.keyCode.DOWN:case a.ui.keyCode.LEFT:}return!0},_handleEvents:{keydown:function(b){var c,d,e,f,g=a(b.target).data("ui-sheet-cell-cursor")||{column:0,row:0};switch(b.keyCode){case a.ui.keyCode.HOME:case a.ui.keyCode.END:case a.ui.keyCode.PAGE_UP:case a.ui.keyCode.PAGE_DOWN:case a.ui.keyCode.UP:case a.ui.keyCode.RIGHT:case a.ui.keyCode.DOWN:case a.ui.keyCode.LEFT:if(b.preventDefault(),!this._keyNavigating&&(this._keyNavigating=!0,cell.addClass("ui-state-active"),c=this._startKeyNavigation(b,g),c===!1))return}switch(b.keyCode){case a.ui.keyCode.HOME:e=this._valueMin();break;case a.ui.keyCode.END:e=this._valueMax();break;case a.ui.keyCode.PAGE_UP:e=this._trimAlignValue(d+(this._valueMax()-this._valueMin())/this.numPages);break;case a.ui.keyCode.PAGE_DOWN:e=this._trimAlignValue(d-(this._valueMax()-this._valueMin())/this.numPages);break;case a.ui.keyCode.UP:case a.ui.keyCode.RIGHT:if(d===this._valueMax())return;e=this._trimAlignValue(d+f);break;case a.ui.keyCode.DOWN:case a.ui.keyCode.LEFT:if(d===this._valueMin())return;e=this._trimAlignValue(d-f)}},keyup:function(b){var c=a(b.target).data("ui-slider-handle-index");this._keySliding&&(this._keySliding=!1,this._stop(b,c),this._change(b,c),a(b.target).removeClass("ui-state-active"))}},last:!0})});
